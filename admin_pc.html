<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="css/admin_pc.css">
    <title>Document</title>
</head>

<body>
    <div>
        <div class="admin">
            <h1>Page Admin</h1>
            <label for="">Menu</label>
            <select name="" id="menuB">
                <option value="pcFixe">PC FIXE</option>
                <option value="pcPortable">PC PORTABLE</option>
                <option value="pcGameur">PC GAMEUR</option>
                <option value="promotion">PROMOTION</option>
            </select>
            <label for="">Id:</label><input type="text" id="idB">
            <label for="">Nom:</label><input type="text" id="nameB">
            <label for="">Description:</label><input type="text" id="denoB">
            <label for="">Dispo:</label><input type="text" id="dispoB">
            <label for="">Prix:</label><input type="text" id="priceB">
            <label for="">Image:</label><input type="text" id="imgB" placeholder="img/nom_article.jpg">
            <div class="button">
                <button id="insert">INSERT</button>
                <button id="select">SELECT</button>
                <button id="selectAll">SELECT ALL</button>
                <button id="update">UPDATE</button>
                <button id="delete">DELETE</button>
            </div>
        </div>
        <table class="table">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Id</th>
                    <th scope="col">Nom</th>
                    <th scope="col">Denomination</th>
                    <th scope="col">Dispo</th>
                    <th scope="col">Prix</th>
                    <th scope="col">Editer</th>
                    <th scope="col">Supprimer</th>
                </tr>
            </thead>
            <tbody>
                <tr class="colum">
                    <th class="row">1</th>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                    <td>@mdo</td>
                    <td><button class="edit">Edit</button></td>
                    <td><button class="delete">Delete</button></td>
                </tr>
                <tr>
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                    <td>@fat</td>
                    <td><button class="edit">Edit</button></td>
                    <td><button class="delete">Delete</button></td>
                </tr>
                <tr>
                    <th scope="row">3</th>
                    <td>Larry</td>
                    <td>the Bird</td>
                    <td>@twitter</td>
                    <td>@twitter</td>
                    <td><button class="edit">Edit</button></td>
                    <td><button class="delete">Delete</button></td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAM3I5CDdy3-xLrPd_dRBb1kqztc4RdVdA",
        authDomain: "projet-ecommerce-grp2.firebaseapp.com",
        databaseURL: "https://projet-ecommerce-grp2-default-rtdb.firebaseio.com/",
        projectId: "projet-ecommerce-grp2",
        storageBucket: "projet-ecommerce-grp2.appspot.com",
        messagingSenderId: "134275146361",
        appId: "1:134275146361:web:7061a84c95240bb203eaa8"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);

    import { getDatabase, get, ref, set, child, update, remove }
        from "https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js";

    const db = getDatabase();

    // REFERENCES
    let menub = document.querySelector("#menuB");
    let idb = document.querySelector("#idB");
    let nameb = document.querySelector("#nameB");
    let denob = document.querySelector("#denoB");
    let dispob = document.querySelector("#dispoB");
    let priceb = document.querySelector("#priceB");
    let imgb = document.querySelector("#imgB");

    let insertBtn = document.querySelector("#insert");
    let selectBtn = document.querySelector("#select");
    let selectAllBtn = document.querySelector("#selectAll");
    let updateBtn = document.querySelector("#update");
    let deleteBtn = document.querySelector("#delete");

    // FUNCTION INSERT

    function insertData() {
        set(ref(db, (menuB.value + "/") + idb.value), {
            denomination: nameb.value,
            description: denob.value,
            dispo: dispob.value,
            prixAffiche: "Prix: " + priceb.value + "€",
            img: imgb.value
        })
            .then(() => {
                alert('data inserted')
            })
            .catch((error) => {
                alert('Error : ' + error)
            })
    }
    insertBtn.addEventListener('click', insertData)

    // FUNCTION SELECT

    function selectDAta() {
        const dbref = ref(db);

        get(child(dbref, (menuB.value + "/") + idb.value))
            .then((snapshot) => {
                if (snapshot.exists()) {
                    nameb.value = snapshot.val().denomination;
                    denob.value = snapshot.val().description;
                    dispob.value = snapshot.val().dispo;
                    priceb.value = snapshot.val().prixAffiche;
                    imgb.value = snapshot.val().img
                } else {
                    alert('No User Found !!!')
                }
            })
            .catch((error) => {
                alert('Error :' + error)
            })
    }

    selectBtn.addEventListener('click', selectDAta)

    // FUNCTION UPDATE

    function updateData() {
        update(ref(db, (menuB.value + "/") + idb.value), {
            denomination: nameb.value,
            description: denob.value,
            dispo: dispob.value,
            prixAffiche: "Prix: " + priceb.value + "€",
            img: imgb.value
        })
            .then(() => {
                alert('data updated')
            })
            .catch((error) => {
                alert('Error : ' + error)
            })
    }

    updateBtn.addEventListener('click', updateData)

    // FUNCTION DELETE

    function deleteData() {
        remove(ref(db, (menuB.value + "/") + idb.value), {

        })
            .then(() => {
                alert('data deleted')
            })
            .catch((error) => {
                alert('Error : ' + error)
            })
    }

    deleteBtn.addEventListener('click', deleteData)

    // FUNCTION SELECTALL

    function selectAllData() {
        const users = fetch('https://projet-ecommerce-grp2-default-rtdb.firebaseio.com/pcFixe.json')
            .then(async response => {
                try {
                    const allMyUser = await response.json();
                    console.log(allMyUser);
                } catch (e) {
                    console.log(e);
                }
            })
    }

    selectAllBtn.addEventListener('click', selectAllData)
</script>

</html>